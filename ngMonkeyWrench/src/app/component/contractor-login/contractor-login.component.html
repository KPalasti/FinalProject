<app-contractor-sidebar>Loading...</app-contractor-sidebar>
<!-- Page content -->

<div class='selectBusiness'>
  <div class="col">
    <h1>Welcome {{currentUser.firstName}}  {{currentUser.lastName}}</h1><br>
    <div ngbDropdown class="d-inline-block">
      <button class="btn btn-outline-primary" id="dropdownBasic1" ngbDropdownToggle *ngIf="!showCurrentCall">Select Business</button>
      <div ngbDropdownMenu aria-labelledby="dropdownBasic1" *ngFor='let business of userBusinesses'>
        <button ngbDropdownItem (click)='getServiceCallsByBusinessId(business)'>{{ business.name }}</button>
      </div>
    </div>
  </div>
</div>

<div class="content" *ngIf="showCalls">
  <H1>Service Requests:</H1>
  <br>
  <div class="wrapper radioDatePipe">
    <form action="">
      <input [(ngModel)]="filterBy" type="radio" id="day" name="filterBy" value="day">
      <label for="day"> Day</label>
      <input [(ngModel)]="filterBy" type="radio" id="week" name="filterBy" value="week">
      <label for="week"> Week</label>
      <input [(ngModel)]="filterBy" type="radio" id="month" name="filterBy" value="month">
      <label for="month"> Month</label>
      <input [(ngModel)]="filterBy" type="radio" id="all" name="filterBy" value="all">
      <label for="All">  All</label>
    </form>
    </div>
    <br>
    <br>
    <div class="clientListBox container-fluid" >
      <div>
        <h2>In Progress: </h2>
     </div>
      <div class="callsTable">
        <table class="table table-dark table-striped table-hover">
          <thead>
            <tr>
              <th scope="col">Name</th>
              <th scope="col">Problem</th>
              <th scope="col">Address</th>
              <th scope="col">Scheduled</th>
              <th scope="col">Completed</th>
            </tr>
          </thead>
          <tbody *ngFor='let call of serviceCalls | activeCalls:showComplete | callFilter:filterBy' (click)="getServiceCallById(call)">
            <tr>
              <td>{{call.user?.firstName}} {{call.user?.lastName}}</td>
              <td>{{call.problem?.description}}</td>
              <td>{{call.address?.street}} {{call.address?.city}} {{call.address?.stateAbbv}}</td>
              <td>{{call.dateScheduled | date  : 'short'}} </td>
              <td><input type="checkbox" name="completed" (change)="completeServiceCall(call)"><br></td>
            </tr>
          </tbody>
        </table>
    </div>
  </div>
</div>
<div class="content selectBusiness form-group">
  <div class="serviceCall selectServiceCall" *ngIf="showCurrentCall">

    <table name="singleServiceCall" class="form-group">
      <thead>
        <tr>
          <th><h3>{{currentServiceCall.user?.firstName}} {{currentServiceCall.user?.lastName}}</h3></th>
        </tr>
        <tr>
          <th><h5>{{currentServiceCall.address?.street}} {{currentServiceCall.address?.street2}} {{currentServiceCall.address?.city}}, {{currentServiceCall.address?.stateAbbv}} {{currentServiceCall.address?.zipCode}}</h5></th>
          <th><h6>Created: {{currentServiceCall.dateCreated}}</h6></th>
        </tr>
      </thead>
      <tbody>
        <tr>
        <td>
          Problem:
          <select class="form-control" name="problem" [(ngModel)]="currentServiceCall.problem" >
            <option *ngFor="let problem of allProblems" value="{{problem}}">
              {{problem.description}}
            </option>
          </select>
        </td>
        </tr>
        <tr>
          <td>
            Problem description: <textarea class="serviceCallTextArea form-control" rows="3" >{{currentServiceCall.problemDescription}}</textarea>
          </td>
        </tr>
        <tr>
          <td>
            Solution:
            <select class="form-control" name="solution" [(ngModel)]="currentServiceCall.solution" >
              <option *ngFor="let solution of allSolutions" value="{{solution}}">
                {{solution.description}}
              </option>
            </select>
          </td>
        </tr>
        <tr>
          <td>
            Solution description:<textarea class="serviceCallTextArea form-control" rows="3" [(ngModel)]="currentServiceCall.contractorNotes">{{currentServiceCall.contractorNotes}}</textarea>
          </td>
        </tr>
        <tr>
          <td >
            Estimate: <input type="checkbox" [(ngModel)]="currentServiceCall.estimate">
          </td>
        </tr>
        <tr>
          <td>
            Labor hours: <input class="form-control" type="number" [(ngModel)]="currentServiceCall.hoursLabor">
          </td>
          <td>
            Cost: <input class="form-control" type="number" [(ngModel)]="currentServiceCall.totalCost">
          </td>
        </tr>
        <tr>
          <td>
            Complete: <input type="checkbox" [(ngModel)]="currentServiceCall.completed">
          </td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td>
            <button  class="form-control" (click)="showCurrentCall = false; showCalls = true">Back</button>
          </td>
          <td>
            <button  class="form-control" (click)="updateServiceCall(currentServiceCall)">Save</button>
          </td>
        </tr>
      </tfoot>
    </table>
    <!-- <div class="form-group">
      <label for="name">Name</label>
      <input type="text" class="form-control" id="name"
            required
            [(ngModel)]="model.name" name="name">
    </div>

    <div class="form-group">
      <label for="alterEgo">Alter Ego</label>
      <input type="text"  class="form-control" id="alterEgo"
            [(ngModel)]="model.alterEgo" name="alterEgo">
    </div>

    <div class="form-group">
      <label for="power">Hero Power</label>
      <select class="form-control"  id="power"
              required
              [(ngModel)]="model.power" name="power">
        <option *ngFor="let pow of powers" [value]="pow">{{pow}}</option>
      </select>
    </div> -->
  </div>
</div>
